# Add a pipeline to compute radius. Origin: 0, 0, 0
-
  action: "add_queries"
  queries:
    q1:
      params:
        expression: "max(field('Pressure')).value"
        name: "MaxPressure"
-
  action: "add_pipelines"
  pipelines:
    pl1:
      f1:
        type: "composite_vector"
        params:
          field1: X
          field2: Y
          field3: Z
          output_name: "point3D"
      f2:
        type: "vector_magnitude"
        params:
          field: "point3D"
          output_name: "Radius"
      f3:
        type: "threshold"
        params:
          field: Z
          min_value: "-0.005"
          max_value: "0.005"
    pl2:
      f1:
        type: "composite_vector"
        params:
          field1: X
          field2: Y
          field3: Z
          output_name: "point3D"
      # Radial density: 
      # First calculate radius, bin the particles based on radius
      # then for each bin, calculate avg density
      # then plot.
      # actually it's quite easy...all the direct radial quantities are the same
      f2:
        type: "vector_magnitude"
        params:
          field: "point3D"
          output_name: "Radius"
      f3:
        type: "expression"
        params:
          expression: "MaxPressure - field('Pressure')"
          name: "PressureNormalized"
-
  action: "add_queries"
  queries:
    q3:
      pipeline: "pl1"
      params:
        expression: "binning('Pressure', 'avg', [axis('X',num_bins=256,max_val=0.5), axis('Y',num_bins=256,max_val=0.5), axis('Z', [-0.005,0.005])])"
        name: "Pressure_binned"
    q4:
      pipeline: "pl2"
      params:
        expression: "binning('Density', 'avg', [axis('Radius',num_bins=256,max_val=1.0)])"
        name: "RadialDensity"
    q5:
      pipeline: "pl2"
      params:
        expression: "binning('PressureNormalized', 'avg', [axis('Radius',num_bins=256,max_val=1.0)])"
        name: "RadialPressureNormalized"
-
  action: "save_session"
  file_name: "sedov_session"
# - 
#   action: "add_extracts"
#   extracts: 
#     e1: 
#       type: "python"
#       pipeline: "pl1"
#       params: 
#         file: "testcases/sedov_vis.py"
#         fields: X
# - 
#   action: "execute"